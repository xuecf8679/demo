<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:jee="http://www.springframework.org/schema/jee"
	xmlns:tx="http://www.springframework.org/schema/tx"
	xmlns:context="http://www.springframework.org/schema/context"
	xmlns:mvc="http://www.springframework.org/schema/mvc"
	xmlns:rdb="http://www.dangdang.com/schema/ddframe/rdb"
	xsi:schemaLocation="http://www.springframework.org/schema/beans 
						http://www.springframework.org/schema/beans/spring-beans-3.0.xsd 
						http://www.springframework.org/schema/tx 
						http://www.springframework.org/schema/tx/spring-tx-3.0.xsd 
						http://www.springframework.org/schema/jee 
						http://www.springframework.org/schema/jee/spring-jee-3.0.xsd 
						http://www.springframework.org/schema/context 
						http://www.springframework.org/schema/context/spring-context-3.0.xsd 
						http://www.springframework.org/schema/mvc 
						http://www.springframework.org/schema/mvc/spring-mvc-3.0.xsd 
						http://www.dangdang.com/schema/ddframe/rdb 
						http://www.dangdang.com/schema/ddframe/rdb/rdb.xsd 
						">
	
	<mvc:annotation-driven />
	<context:component-scan base-package="myD7Util" />
	
	<!--重写jdbcDao模板配置,将默认的JdbcDao更换为MyJdbcDao,默认的配置在jdbcAddon的jar包中 -->
	<bean id="dorado.jdbcDaoTemplate" class="myD7Util.myDB.MyJdbcDao" abstract="true">
		<property name="modelRepository" ref="dorado.jdbc.modelRepository" />
		<property name="SQLRunner" ref="dorado.jdbc.SQLRunner" />
		<property name="queryBuilders">
			<list>
				<ref bean="dorado.jdbc.tableQueryBuilder" />
				<ref bean="dorado.jdbc.sqlViewBuilder" />
				<ref bean="dorado.jdbc.compositeTableQueryBuilder" />
			</list>
		</property>
		<property name="persistBuilders">
			<list>
				<ref bean="dorado.jdbc.tablePersistBuilder" />
				<ref bean="dorado.jdbc.compositeTablePersistBuilder" />
			</list>
		</property>
	</bean>
	<!--定义默认数据源,其jdbcDao对象和dataInterceptor对象使用jdbcAddon的jar包中默认配置的,此处没有再重写,如有需要可以在此处重写覆盖 -->
	<bean id="dataSource" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${dataSource.driverClassName}" />
		<property name="url" value="${dataSource.url}" />
		<property name="username" value="${dataSource.username}" />
		<property name="password" value="${dataSource.password}" />
		<property name="maxActive" value="${dataSource.maxActive}" />
		<property name="maxIdle" value="${dataSource.maxIdle}" />
		<property name="minIdle" value="${dataSource.minIdle}" />
		<property name="maxWait" value="${dataSource.maxWait}" />
		<property name="removeAbandoned" value="${dataSource.removeAbandoned}" />
		<property name="removeAbandonedTimeout" value="${dataSource.removeAbandonedTimeout}" />
		<property name="logAbandoned" value="${dataSource.logAbandoned}" />
		<property name="testWhileIdle" value="${dataSource.testWhileIdle} " />
		<property name="validationQuery" value="${dataSource.validationQuery}" />
		<property name="timeBetweenEvictionRunsMillis" value="${dataSource.timeBetweenEvictionRunsMillis}" />
		<property name="numTestsPerEvictionRun" value="${dataSource.maxActive}" />
		<property name="minEvictableIdleTimeMillis" value="${dataSource.minEvictableIdleTimeMillis}" />
	</bean>
	
	<!-- shardingJDBC配置 -->
	<bean id="dataSource_lu" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${dataSource_lu.driverClassName}" />
		<property name="url" value="${dataSource_lu.url}" />
		<property name="username" value="${dataSource_lu.username}" />
		<property name="password" value="${dataSource_lu.password}" />
		<property name="maxActive" value="${dataSource_lu.maxActive}" />
		<property name="maxIdle" value="${dataSource_lu.maxIdle}" />
		<property name="minIdle" value="${dataSource_lu.minIdle}" />
		<property name="maxWait" value="${dataSource_lu.maxWait}" />
		<property name="removeAbandoned" value="${dataSource_lu.removeAbandoned}" />
		<property name="removeAbandonedTimeout" value="${dataSource_lu.removeAbandonedTimeout}" />
		<property name="logAbandoned" value="${dataSource_lu.logAbandoned}" />
		<property name="testWhileIdle" value="${dataSource_lu.testWhileIdle} " />
		<property name="validationQuery" value="${dataSource_lu.validationQuery}" />
		<property name="timeBetweenEvictionRunsMillis" value="${dataSource_lu.timeBetweenEvictionRunsMillis}" />
		<property name="numTestsPerEvictionRun" value="${dataSource_lu.maxActive}" />
		<property name="minEvictableIdleTimeMillis" value="${dataSource_lu.minEvictableIdleTimeMillis}" />
	</bean>
	<bean id="dataSource_ji" class="org.apache.commons.dbcp.BasicDataSource"
		destroy-method="close">
		<property name="driverClassName" value="${dataSource_ji.driverClassName}" />
		<property name="url" value="${dataSource_ji.url}" />
		<property name="username" value="${dataSource_ji.username}" />
		<property name="password" value="${dataSource_ji.password}" />
		<property name="maxActive" value="${dataSource_ji.maxActive}" />
		<property name="maxIdle" value="${dataSource_ji.maxIdle}" />
		<property name="minIdle" value="${dataSource_ji.minIdle}" />
		<property name="maxWait" value="${dataSource_ji.maxWait}" />
		<property name="removeAbandoned" value="${dataSource_ji.removeAbandoned}" />
		<property name="removeAbandonedTimeout" value="${dataSource_ji.removeAbandonedTimeout}" />
		<property name="logAbandoned" value="${dataSource_ji.logAbandoned}" />
		<property name="testWhileIdle" value="${dataSource_ji.testWhileIdle} " />
		<property name="validationQuery" value="${dataSource_ji.validationQuery}" />
		<property name="timeBetweenEvictionRunsMillis" value="${dataSource_ji.timeBetweenEvictionRunsMillis}" />
		<property name="numTestsPerEvictionRun" value="${dataSource_ji.maxActive}" />
		<property name="minEvictableIdleTimeMillis" value="${dataSource_ji.minEvictableIdleTimeMillis}" />
	</bean>
	<rdb:strategy id="databaseStrategy_carPosition" sharding-columns="carNo" algorithm-class="sharding.DatabaseShardingAlgorithm_carPosition"/>
	<rdb:data-source id="dataSource_sharding">
        <rdb:sharding-rule data-sources="dataSource_lu,dataSource_ji" default-data-source="dataSource_lu">
            <rdb:table-rules>
                <rdb:table-rule logic-table="carPosition_1" actual-tables="carPosition_1" database-strategy="databaseStrategy_carPosition"/>
                <rdb:table-rule logic-table="carInfo" actual-tables="carInfo"/>
            </rdb:table-rules>
            <!-- 
            <rdb:binding-table-rules>
                <rdb:binding-table-rule logic-tables="t_order,t_order_item"/>
            </rdb:binding-table-rules>
             -->
        	<rdb:default-database-strategy sharding-columns="none" algorithm-class="com.dangdang.ddframe.rdb.sharding.api.strategy.database.NoneDatabaseShardingAlgorithm"/>
        	<rdb:default-table-strategy sharding-columns="none" algorithm-class="com.dangdang.ddframe.rdb.sharding.api.strategy.table.NoneTableShardingAlgorithm"/>
        </rdb:sharding-rule>
        <rdb:props>
            <prop key="metrics.enable">false</prop>
        </rdb:props>
    </rdb:data-source>

	<!--定义数据库鲁的jdbcDao-->
	<bean id="jdbcDao_lu" parent="dorado.jdbcDaoTemplate">
		<property name="dataSource" ref="dataSource_lu"/>
	</bean>
	<!--定义数据库吉的jdbcDao-->
	<bean id="jdbcDao_ji" parent="dorado.jdbcDaoTemplate">
		<property name="dataSource" ref="dataSource_ji"/>
	</bean>
	<!--定义shardingJDBC的jdbcDao-->
	<bean id="jdbcDao_sharding" parent="dorado.jdbcDaoTemplate">
		<property name="dataSource" ref="dataSource_sharding"/>
	</bean>
	<!--覆盖默认的jdbcDao,该配置在jdbcAddon的jar包中 -->
	<bean id="dorado.jdbcDao" parent="dorado.jdbcDaoTemplate">
		<property name="dataSource" ref="dataSource"/>
	</bean>
	
	<bean id="transactionManager_lu"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource_lu" />
	</bean>
	<bean id="transactionManager_ji"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource_ji" />
	</bean>
	<bean id="transactionManager_sharding"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource_sharding" />
	</bean>
	<bean id="transactionManager"
		class="org.springframework.jdbc.datasource.DataSourceTransactionManager">
		<property name="dataSource" ref="dataSource" />
	</bean>
	
	<tx:annotation-driven transaction-manager="transactionManager_lu" />
	<tx:annotation-driven transaction-manager="transactionManager_ji" />
	<tx:annotation-driven transaction-manager="transactionManager_sharding" />
	<tx:annotation-driven transaction-manager="transactionManager" />
	
	<bean class="sharding.TestEngineStartup"></bean>
</beans>
